---
title:  "[Unity ê°•ì˜] ë±€ì„œë¼ì´í¬ ê°•ì˜ - ë³´ìŠ¤, AI "
excerpt: ""

categories:
    - Class VamSurLike
tags:
    - [C#, Unity, VamSurLike]

toc: true
toc_sticky: true
 
date: 2025-03-27 05:00

---
- - -


<br>
- - - 

<!--&nbsp;ğŸ”¹ âœ” âœ…  -->


# 1. ë³´ìŠ¤
âœ” ë³´ìŠ¤ ë¦¬ì†ŒìŠ¤ Sprite ê°€ì ¸ì˜¤ê¸°  
âœ” ì• ë‹ˆë©”ì´ì…˜ ë§Œë“¤ê¸°  
âœ” ì• ë‹ˆë©”ì´í„°ì— ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€í•˜ê¸°.  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  

<br><br><br><br>

# 2. ìˆ˜ì • ì½”ë“œ
ğŸ”¹ GameScene.cs => ì¡°ê±´(ëª©í‘œ í‚¬ ë‹¬ì„±) -> í•„ë“œ ë‚´ ëª¬ìŠ¤í„° ë””ìŠ¤í°, ì¼ë°˜ ëª¹ ìŠ¤í° x, ë³´ìŠ¤ ìƒì„±  
ğŸ”¹ ObjectManager => ëª¬ìŠ¤í„° ì†Œí™˜(ì¼ë°˜ ëª¹ ~ ë³´ìŠ¤ ëª¹) ìˆ˜ì •, DespawnAllMonsters() ì¶”ê°€  
ğŸ”¹ MonsterController => ìƒíƒœ íŒ¨í„´ ì¶”ê°€.  
ğŸ”¹ BossController => ìƒíƒœë¡œ ë³´ìŠ¤ ê´€ë¦¬ (Idle, Moving, Skill, Dead)  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info} 

## GameScene.cs
``HandleOnkillCountChanged()``  
âœ” í‚¬ ìˆ˜ ì²´í¬, 5í‚¬ -> ìŠ¤í…Œì´ì§€ íƒ€ì…ìœ¼ë¡œ ìŠ¤í° ì¡°ì ˆí•˜ê¸°, ëª¨ë“  ëª¬ìŠ¤í„° ë””ìŠ¤í°, ë³´ìŠ¤ ìƒì„±.  
âœ” SpawningPool - bool Stoppedìœ¼ë¡œ ìŠ¤í° ì •ì§€  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info} 

<details>
<summary>GameScene</summary>
<div class="notice--primary" markdown="1"> 

```c# 
public class GameScene : MonoBehaviour
{
    SpawningPool _spawningPool;

    StageType _stageType;
    public StageType StageType 
    {
        get { return _stageType; }
        set 
        {
            _stageType = value;
            if (_spawningPool !=null)
            {
                switch (value) 
                {
                    case StageType.Normal:
                        _spawningPool.Stopped = false;
                        break;
                    case StageType.Boss:
                        _spawningPool.Stopped = true;
                        break;

                }
            }
        }
    }

    void StartLoaded()
    {
        Managers.Game.OnkillCountChanged -= HandleOnkillCountChanged;
        Managers.Game.OnkillCountChanged += HandleOnkillCountChanged;

    }

    public void HandleOnkillCountChanged(int killCount)
    {
        Managers.UI.GetSceneUI<UI_GameScene>().SetKillCount(killCount);
        if (killCount==5)
        {
            StageType = StageType.Boss;
            Managers.Object.DespawnAllMonsters();
            Vector2 spawnPos = Utils.GenerateMonsterSpawnPosition(Managers.Game.Player.transform.position, 5, 10);
            Managers.Object.Spawn<MonsterController>(spawnPos, MonsterID.BOSS_ID);
        }
    }
}
```
</div>
</details>


## ObjectManager
âœ” ëª¬ìŠ¤í„° ìŠ¤í°(ì¼ë°˜ ëª¹ ~ ë³´ìŠ¤ ëª¹) ìˆ˜ì •, DespawnAllMonsters() ì¶”ê°€  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info} 

<details>
<summary>ObjectManager</summary>
<div class="notice--primary" markdown="1"> 

```c# 
public class ObjectManager 
{
    public T Spawn<T>(Vector3 position, int  templateID =0) where T : BaseController 
    {
        System.Type type = typeof(T);

        else if(type == typeof(MonsterController))
        {
            string name = "";
            switch (templateID) 
            {
                case MonsterID.GOBLIN_ID:
                    name = PrefabsName.Goblin;
                    break;
                case MonsterID.SNAKE_ID:
                    name = PrefabsName.Snake;
                    break;
                case MonsterID.BOSS_ID:
                    name = PrefabsName.Boss;
                    
                    break;
            }
            GameObject go = Managers.Resource.Instantiate(name, pooling : true);
            go.transform.position = position;

            MonsterController mc = go.GetOrAddComponent<MonsterController>();
            Monster.Add(mc);
            mc.Init();

            return mc as T;
        }

    public void DespawnAllMonsters() 
    {
        var mosters = Monster.ToList();

        foreach (var monster in mosters)
        {
            Despawn<MonsterController>(monster);
        }
    }
}
```
</div>
</details>

## MonsterController
âœ” bool _attack = false; bool _chase = false;  
âœ” ë“± boolë¡œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë©´ ë‚˜ì¤‘ì— ë§ì€ ê²½ìš°ë“¤ì´ ë°œìƒí•´ì„œ ë³µì¡í•´ì§„ë‹¤.  
âœ” ëŒ€ë¶€ë¶„ ìƒíƒœ ê¸°ë°˜(State)ìœ¼ë¡œ ê°€ëŠ¥í•˜ë‹¤.(FSM)   
âœ” ë³µì¡í•œ ê²½ìš° Behaviour Tree ì‚¬ìš©   
âœ” MonsterController - ìƒíƒœ ê¸°ë°˜ ì‚¬ìš©.  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info} 

<details>
<summary>MonsterController</summary>
<div class="notice--primary" markdown="1"> 

```c# 
public class MonsterController : CreatureController
{

    #region State Pattern

    CreatureState _creatureState = CreatureState.Moving;
    public virtual CreatureState CreatureState 
    {
        get { return _creatureState; }
        set 
        {
            _creatureState = value;
            UpdateAnimation();
        }
    }

    protected Animator _animator;

    public virtual void UpdateAnimation() { }

    public override void UpdateController()
    {
        base.UpdateController();

        switch (CreatureState) 
        {
            case CreatureState.Idle:
                UpdateIdle();
                break;
            case CreatureState.Skill:
                UpdateSkill();
                break;
            case CreatureState.Moving:
                UpdateMoving();
                break;
            case CreatureState.Dead:
                UpdateDead();
                break;
        }
    }

    protected virtual void UpdateIdle() { }
    protected virtual void UpdateSkill() { }
    protected virtual void UpdateMoving() { }
    protected virtual void UpdateDead() { }
    #endregion

```
</div>
</details>


## BossController
âœ” ì¼ë°˜ì ì¸ ê²½ìš° - ë°ì´í„° ì‹œíŠ¸ë¥¼ í†µí•´ ë³´ìŠ¤, ëª¬ìŠ¤í„° ìƒê´€ì—†ì´ í•˜ë‚˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ê°€ëŠ¥í•˜ë‹¤.  
âœ” í”„ë¡œì íŠ¸ - BossControllerë¥¼ í†µí•´ ë³´ìŠ¤ ì»¨íŠ¸ë¡¤  
âœ” ìƒíƒœë¡œ ë³´ìŠ¤ ê´€ë¦¬ (Idle, Moving, Skill, Dead)  
âœ” ê³µê²© ë“± ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ - ì½”ë£¨í‹´ìœ¼ë¡œ ê´€ë¦¬  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info} 

<details>
<summary>BossController</summary>
<div class="notice--primary" markdown="1"> 

```c# 
public class BossController : MonsterController
{
    public override bool Init()
    {
        base.Init();

        _animator = GetComponent<Animator>();
        CreatureState = CreatureState.Moving;
        Hp = 100000;

        return true;
    }

    public override void UpdateAnimation()
    {
        switch (CreatureState) 
        {
            case CreatureState.Idle:
                _animator.Play("Idle");
                break;
            case CreatureState.Moving:
                _animator.Play("Moving");
                break;
            case CreatureState.Skill:
                _animator.Play("Attack");
                break;
            case CreatureState.Dead:
                _animator.Play("Death");
                break;
        }
    }

    float _range = 2.0f;
    protected override void UpdateMoving()
    {
        PlayerController pc = Managers.Game.Player;
        if (pc.IsValid() == false)
            return;

        Vector3 dir = pc.transform.position - transform.position;

        if (dir.magnitude <_range)
        {
            CreatureState = CreatureState.Skill;

            //float animLength = _animator.runtimeAnimatorController.animationClips.Length;
            float animLength = 0.41f;
            Wait(animLength);
        }
    }

    protected override void UpdateSkill()
    {
        if (_coWait ==null)
            CreatureState = CreatureState.Moving;

    }

    protected override void UpdateDead()
    {
        if (_coWait == null)
            Managers.Object.Despawn(this);
    }

    #region Wait Coroutine

    Coroutine _coWait;

    void Wait(float waitSecond) 
    {
        if (_coWait != null)
            StopCoroutine(_coWait);
        _coWait = StartCoroutine(CoStartWait(waitSecond));

    }

    IEnumerator CoStartWait(float waitSecond) 
    {
        yield return new WaitForSeconds(waitSecond);
        _coWait = null;
    }

    #endregion

    public override void OnDamaged(BaseController attacker, int damage)
    {
        base.OnDamaged(attacker, damage);
    }

    protected override void OnDead()
    {
        CreatureState = CreatureState.Dead;
        Wait(2.0f);
    }

}

```
</div>
</details>


## DEFINE

<details>
<summary>DEFINE</summary>
<div class="notice--primary" markdown="1"> 

```c# 
public struct MonsterID
{
    public const int GOBLIN_ID = 1;
    public const int SNAKE_ID = 2;
    public const int BOSS_ID = 3;
}

public struct PrefabsName
{
    public const string Goblin = "Goblin_01.prefab";
    public const string Snake = "Snake_01.prefab";
    public const string Player = "Slime_01.prefab";
    public const string Boss = "Boss_01.prefab";
}

public enum StageType
{
    Normal,
    Boss,
}

public enum CreatureState
{
    Idle,
    Moving,
    Skill,
    Dead,
}
```
</div>
</details>

<br><br><br><br>

# ì´ê²ƒì €ê²ƒ ë©”ëª¨

## ì• ë‹ˆë©”ì´ì…˜ ìƒì„±  
ì• ë‹ˆë©”ì´ì…˜ - Spriteë“¤ì„ ì—¬ëŸ¬ ê°œ ë“œë˜ê·¸í•´ì„œ Hierarchyì— ì˜¬ë¦¬ë©´ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ë‹¤.  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice} 

## ì–´ë“œë ˆì„œë¸” 
ë³´ìŠ¤ ì–´ë“œë ˆì„œë¸” ë“±ë¡í•˜ë©´ í¬í•¨ëœ ì• ë‹ˆë©”ì´ì…˜ë„ í¬í•¨ë˜ì–´ ë“±ë¡ëœë‹¤.  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice} 

<br><br><br>
- - - 

# ì¡ë‹´, ì¼ê¸°?
ìƒíƒœíŒ¨í„´ êµ¬ì¡° íŒŒì•…í•˜ê¸°, ë§ì´ ì¨ë³´ê¸°  
Behaviour Tree ê³µë¶€í•˜ê¸°  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--success}  


<br><br>
- - -