---
title:  "[Unity ê°•ì˜] ë±€ì„œë¼ì´í¬ ê°•ì˜ - ìŠ¤í‚¬ ë§µ(ë¬´í•œë§µ) ê°œì„  "
excerpt: ""

categories:
    - Class VamSurLike
tags:
    - [C#, Unity, VamSurLike]

toc: true
toc_sticky: true
 
date: 2025-03-24 05:00

---
- - -

`IsSubclassOf` 

<br>
- - - 

<!--&nbsp;ğŸ”¹ âœ” âœ…  -->


# 1. ê°œì„  ì½”ë“œ  

## PlayerController(í‰íƒ€ ì¶”ê°€)
âœ” Init - StartEgoSword() ì¶”ê°€  
âœ” StartEgoSword() EgoSword ìŠ¤í°, ìœ„ì¹˜ ì„¤ì •, ì½”ë£¨í‹´ ì‹œì‘  
âœ” CollectEnv - Gridë¥¼ ì‚¬ìš©í•´ì„œ ì²´í¬  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  

<details>
<summary>PlayerController</summary>
<div class="notice--primary" markdown="1"> 

```c# 
public class PlayerController : CreatureController
{
    public override bool Init()
    {
        if (base.Init() == false)
            return false;
        _speed = 5.0f;

        Managers.Game.OnMoveDirChanged += HandleOnMoveDirChanged;

        StartProjectile();
        StartEgoSword();

        return true;
    }

    void CollectEnv() 
    {
        float sqrCollectDis = EnvCollectDist * EnvCollectDist;

        var findGems = GameObject.Find("@Grid").GetComponent<GridController>().GatherObjects(transform.position, EnvCollectDist + 0.4f);

        foreach (var go in findGems)
        {
            GemController gem = go.GetComponent<GemController>();

            Vector3 dir = gem.transform.position - transform.position;
            if (dir.sqrMagnitude <= EnvCollectDist)
            {
                Managers.Game.Gem += 1;
                Managers.Object.Despawn(gem);
            }   
        }
    }

    #region EgoSword

    EgoSwordController _egoSword;
    void StartEgoSword() 
    {
        if (_egoSword.IsValid())
            return;

        _egoSword = Managers.Object.Spawn<EgoSwordController>(_indicator.position, SkillID.EGO_SWORD_ID);
        _egoSword.transform.SetParent(_indicator);

        _egoSword.ActivateSkill();
    }

    #endregion
}
```
</div>
</details>

## ëª¬ìŠ¤í„° ìŠ¤í° ê°œì„  
ëª¬ìŠ¤í„° ìŠ¤í° í”Œë ˆì´ì–´ ê¸°ì¤€ìœ¼ë¡œ Min~Maxì˜ ëœë¤ì› ë²”ìœ„ì—ì„œ ìŠ¤í°  
âœ” SpawningPool - TrySpawn()ì—ì„œ ìŠ¤í° Position ì„¤ì •   
âœ” Utils.GenerateMonsterSpawnPosition - ëœë¤ ìœ„ì¹˜ ê³„ì‚°, ë°˜í™˜  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  

<details>
<summary>PlayerController</summary>
<div class="notice--primary" markdown="1"> 

```c# 
public class SpawningPool : MonoBehaviour
{
    private void TrySpawn()
    {
        int monsterCount = Managers.Object.Monster.Count;
        if (monsterCount > _maxMonsterCount)
            return;

        Vector3 randPos = Utils.GenerateMonsterSpawnPosition(Managers.Game.Player.transform.position,10,15);
        MonsterController mc = Managers.Object.Spawn<MonsterController>(randPos,Random.Range(0, 2));
    }
}

public class Utils
{
    public static Vector2 GenerateMonsterSpawnPosition(Vector2 characterPosition, float minDistance = 10.0f, float maxDistance = 20.0f) 
    {
        float angle = Random.Range(0, 360) * Mathf.Deg2Rad;

        float distance = Random.Range(minDistance, maxDistance);

        float xDist = MathF.Cos(angle) * distance;
        float yDist = MathF.Sin(angle) * distance;

        Vector2 spawnPosition = characterPosition + new Vector2(xDist, yDist);

        return spawnPosition;
    }
}
```
</div>
</details>

<br><bR><br><bR>

# 2. ìŠ¤í‚¬ ì¶”ê°€ (EgoSwordController)
âœ” EgoSword(í‰íƒ€) ì¶”ê°€  
âœ” SkillData.xml ìŠ¤í‚¬ ë°ì´í„° ì¶”ê°€  
ğŸ”¹ **EgoSwordController**  
âœ… Init() - ë¬¼ë¦¬ ì ìš©, 1 ~ 4 íƒ€ Owner, Damage Set  
âœ… SetParticles() - í‰íƒ€ ê°ë„ ì²´í¬   
âœ… TurnOnPhysics - ë¬¼ë¦¬ ì ìš© On   
ğŸ”¹ **EgoSwordChild**  
âœ… 1 ~ 4 íƒ€ SET  
âœ… OnTriggerEnter2D ëª¬ìŠ¤í„° ì¶©ëŒ ì‹œ ì²´í¬, ë°ë¯¸ì§€  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  

<details>
<summary>SkillData.xml</summary>
<div class="notice--primary" markdown="1"> 

```xml
<?xml version="1.0" encoding="utf-8"?>
<SkillDatas>
  <SkillData templateID="1" name="í™”ì—¼êµ¬" type="Projectile" prefab="FireProjectile.prefab" damage="1000" speed="2" >
  </SkillData>
  <SkillData templateID="10" name="í‰íƒ€" type="Melee" prefab="EgoSword.prefab" damage="1000">
  </SkillData>
</SkillDatas>
```
</div>
</details>

<details>
<summary>EgoSwordController</summary>
<div class="notice--primary" markdown="1"> 

```c#

public class EgoSwordController : SkillController
{
    [SerializeField]
    ParticleSystem[] _swingParticles;

    protected enum SwingType 
    {
        First,
        Second,
        Third,
        Fourth
    }

    //âœ… Init() - ë¬¼ë¦¬ ì ìš©, 1~4íƒ€ Owner, Damage Set  
    public override bool Init()
    {
        base.Init();

        // Active ë˜ê¸° ì „ê¹Œì§€ ì½œë¼ì´ë” ë¬¼ë¦¬ ì ìš© x
        for (int i = 0; i < _swingParticles.Length; i++)
            _swingParticles[i].GetComponent<Rigidbody2D>().simulated = false;

        for (int i = 0; i < _swingParticles.Length; i++)
            _swingParticles[i].gameObject.GetOrAddComponent<EgoSwordChild>().SetInfo(Managers.Object.Player, 100);
        return true;
    }

    public void ActivateSkill() 
    {
        StartCoroutine(CoSwingSword());
    }


    float CoolTime = 2.0f;
    IEnumerator CoSwingSword() 
    {
        while (true)
        {
            yield return new WaitForSeconds(CoolTime);

            SetParticles(SwingType.First);                  // ìŠ¤í‚¬ ê°ë„ ì„¸íŒ…
            _swingParticles[(int)SwingType.First].Play();   // íŒŒí‹°í´ í”Œë ˆì´
            TurnOnPhysics(SwingType.First, true);           // ë¬¼ë¦¬ ì ìš©
            yield return new WaitForSeconds(_swingParticles[(int)SwingType.First].main.duration); //íŒŒí‹°í´ ì‹¤í–‰ ì‹œê°„
            TurnOnPhysics(SwingType.First, false);

            SetParticles(SwingType.Second);
            _swingParticles[(int)SwingType.Second].Play();
            TurnOnPhysics(SwingType.Second, true);
            yield return new WaitForSeconds(_swingParticles[(int)SwingType.Second].main.duration); 
            TurnOnPhysics(SwingType.Second, false);

            SetParticles(SwingType.Third);
            _swingParticles[(int)SwingType.Third].Play();
            TurnOnPhysics(SwingType.Third, true);
            yield return new WaitForSeconds(_swingParticles[(int)SwingType.Third].main.duration); 
            TurnOnPhysics(SwingType.Third, false);

            SetParticles(SwingType.Fourth);
            _swingParticles[(int)SwingType.Fourth].Play();
            TurnOnPhysics(SwingType.Fourth, true);
            yield return new WaitForSeconds(_swingParticles[(int)SwingType.Fourth].main.duration); 
            TurnOnPhysics(SwingType.Fourth, false);
        }
        
    }

    private void SetParticles(SwingType swingtype) // ê°ë„ í‹€ì–´ì£¼ê¸°
    {
        float z = transform.parent.transform.eulerAngles.z;
        float radian = (Mathf.PI / 180) * z * -1;

        var main = _swingParticles[(int)swingtype].main;
        main.startRotation = radian;
    }

    private void TurnOnPhysics(SwingType swingtype, bool simulated) //ë¬¼ë¦¬ì ìš©
    {
        for (int i = 0; i < _swingParticles.Length; i++)
            _swingParticles[i].GetComponent<Rigidbody2D>().simulated = false;

        _swingParticles[(int)swingtype].GetComponent<Rigidbody2D>().simulated = simulated;
    }
}
```
</div>
</details>

<details>
<summary>EgoSwordChild</summary>
<div class="notice--primary" markdown="1"> 

```c#
public class EgoSwordChild : MonoBehaviour
{
    BaseController _owner;
    int _damage;

    public void SetInfo(BaseController owner, int damage) // ìŠ¤í‚¬ ìš”ì†Œ ì„¸íŒ…
    {
        _owner = owner;
        _damage = damage;
    }
    private void OnTriggerEnter2D(Collider2D collision)
    {
        MonsterController mc = collision.transform.GetComponent<MonsterController>();
        if (mc.IsValid() == false)
            return;

        mc.OnDamaged(_owner,_damage);
    }
}

```
</div>
</details>

<br><br>

## ObjectManager - Spawn (IsSubclassOf)
typeof(T).IsSubclassOf(typeof(SkillController))  
Tê°€ SkillControllerë¥¼ ìƒì†í–ˆëŠ”ì§€ ì²´í¬í•˜ëŠ” ì½”ë“œ
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  

<details>
<summary>ObjectManager</summary>
<div class="notice--primary" markdown="1"> 

```c#
public class ObjectManager 
{
    public T Spawn<T>(Vector3 position, int  templateID =0) where T : BaseController 
    {
        System.Type type = typeof(T);

        else if (typeof(T).IsSubclassOf(typeof(SkillController)))
        {
            if (Managers.Data.SkillDic.TryGetValue(templateID,out Data.SkillData skillData)==false)
            {
                Debug.LogError($"ObjectManager Spawn Skill Failed{templateID}");
                return null;
            }
            GameObject go = Managers.Resource.Instantiate(SkillPrefabsName.EgoSword, pooling: true);
            go.transform.position = position;

            T t = go.GetComponent<T>();
            
            t.Init();

            return t;
        }
        return null;
    }
}
```
</div>
</details>

<br><bR><br><bR>

# 3. ë§µ ê°œì„  - ë¬´í•œ ë§µ (MapTileController)
âœ” X(4) ê°œì˜ mapì„ í”Œë ˆì´ì–´ ìœ„ì¹˜ì— ë”°ë¼ ìœ„ì¹˜ ë³€ê²½í•´ì„œ ë¬´í•œì²˜ëŸ¼ ë§Œë“ ë‹¤. (ë°©ë²•ì€ ë‹¤ì–‘)  
âœ” Cameraì— Collider2D ë°°ì¹˜, í˜„ì¬ ìœ„ì¹˜ ì²´í¬, OnTriggerExit2Dë¥¼ ì‚¬ìš©í•´ ë§µ ì¬ì‚¬ìš©  
![Image](https://github.com/user-attachments/assets/a61b195b-9bb5-40e6-9f31-613c821d371e)  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  


<details>
<summary>MapTileController</summary>
<div class="notice--primary" markdown="1"> 

```c#
public class MapTileController : MonoBehaviour
{
    private void OnTriggerExit2D(Collider2D collision)
    {
        Camera camera = collision.gameObject.GetComponent<Camera>();
        if (camera == null)
            return;

        Vector3 dir = camera.transform.position - transform.position;

        float dirX = dir.x < 0 ? -1 : 1;
        float dirY = dir.y < 0 ? -1 : 1;

        if (Mathf.Abs(dir.x) > Mathf.Abs(dir.y))
            transform.Translate(Vector3.right * dirX * 200);
        else
            transform.Translate(Vector3.up * dirY * 200);
    }
}
```
</div>
</details>

<br><br><br><br>

# ì´ê²ƒì €ê²ƒ ë©”ëª¨

## ë¬´ì êµ¬í˜„
ìƒëŒ€ì—ê²Œ ë¬´ì  ë²„í”„? -> ë³µì¡  
ìƒëŒ€ì—ê²Œ ì¶©ëŒ ë²”ìœ„ë¥¼ ì—†ì• ë©´ ë¬´ì ì´ ë  ìˆ˜ ìˆë‹¤.  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice} 


<br><br><br>
- - - 

# ì¡ë‹´, ì¼ê¸°?
ì½”ë“œ, ì–´ë“œë ˆì„œë¸”, í”„ë¦¬íŒ¹ ë“± ê·œì¹™ì„ ë§Œë“¤ê³  êµ¬ì¡°ë¥¼ ë§Œë“  í›„ ì‘ì—…ì„ í•˜ëŠ” ê²Œ ì´í•´ë˜ëŠ” ëŠë‚Œì´ë‹¤.  
ì¢€ ë” í¸í•˜ê³  ë­”ê°€ë¥¼ í•´ì•¼ í•  ë•Œ ì–´ë””ë¥¼ ê±´ë“œë¦¬ë©´ ë˜ëŠ”ì§€ ì•Œ ê±° ê°™ë‹¤.  
ë‹¤ìŒ ê°•ì˜ UI  
UI - Sprite, Prefab ì˜®ê²¨ë†“ê¸°.  
UI íŒì—…ì¸ì§€ ìœ ì§€ë˜ëŠ”ì§€, ë–  ìˆëŠ” ìƒíƒœì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì„¤ê³„  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--success}  


<br><br>
- - -