---
title:  "[Unity ê°•ì˜] ë±€ì„œë¼ì´í¬ ê°•ì˜ - ì•„ì´í…œ ì¤ê¸° (ê·¸ë¦¬ë“œë¥¼ ì´ìš©í•œ ìµœì í™”) "
excerpt: ""

categories:
    - Class VamSurLike
tags:
    - [C#, Unity, VamSurLike]

toc: true
toc_sticky: true
 
date: 2025-03-19 05:00

---
- - -

<br>
- - - 

<!--&nbsp;ğŸ”¹ âœ” âœ…  -->

# ì ¬ ì¤ê¸°
âœ” ë³´ì„ ì¤ê¸°  
1.&nbsp;&nbsp;í”Œë ˆì´ì–´ê°€ ì¤ê¸°? O  
2.&nbsp;&nbsp;ë³´ì„ì´ ì¤ ë‹¹í•˜ê¸°?  
âœ” ì¼ì„ ì–»ì„ ë•Œ  
1.&nbsp;&nbsp;ì¼ê³¼ ìºë¦­í„° ê°„ì˜ ê±°ë¦¬ íŒë³„ (ëª¨ë“  ì¼ê³¼ ê±°ë¦¬ íŒë³„?)  
2.&nbsp;&nbsp;êµ¬ì—­ì„ êµ¬ë¶„ ì§€ì–´ ìºë¦­í„°ì˜ ì£¼ë³€ êµ¬ì—­ íƒìƒ‰ (ê·¸ë¦¬ë“œ)  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  

## ê²Œì„ë‚´ ëª¨ë“ ì¼ê³¼ ê±°ë¦¬íŒë³„ 
if (dir.Magnitude <= CollectDis) ì—°ì‚° ëŠë¦¼  
if (dir.sqrMagnitude <= sqrCollectDis) ì—°ì‚° ë¹ ë¦„  
âœ… ê±°ë¦¬ ë¹„êµ(<=, >=)ëŠ” sqrMagnitude ì‚¬ìš© ì¶”ì²œ!  
âœ… ì •í™•í•œ ê±°ë¦¬ ì¶œë ¥ì´ í•„ìš”í•  ë•Œë§Œ Magnitude ì‚¬ìš©  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  

<details>
<summary>PlayerController - CollectEnv()</summary>
<div class="notice--primary" markdown="1"> 

```c# 
public class PlayerController : CreatureController
{

    float EnvCollectDist { get; set; } = 1.0f;

    void Update()
    {
        CollectEnv();
    }

    void CollectEnv() 
    {
        float sqrCollectDis = EnvCollectDist * EnvCollectDist;
        List<GemController> gems = Managers.Object.Gems.ToList();
        foreach (GemController gem in gems)
        {
            Vector3 dir = gem.transform.position - transform.position;
            if (dir.sqrMagnitude <= EnvCollectDist)
            {
                Managers.Game.Gem += 1;
                Managers.Object.Despawn(gem);
            }
            
        }
    }
}
```
</div>
</details>


<br><br><br><br>

## ê·¸ë¦¬ë“œ ì‚¬ìš©í•œ ìµœì í™”
âœ” ê°™ì€ ì¹¸(Cell)ì— ìˆëŠ” ëª¨ë“  GameObjectë¥¼ ê°™ì´ ê´€ë¦¬  
âœ” `Init()` = Grid ì»´í¬ë„ŒíŠ¸ ì¶”ê°€ or ì°¾ê¸°  
âœ” `GetCell(pos)` - pos ìœ„ì¹˜ì˜ cellì„ ë°˜í™˜, ì²˜ìŒ ë³´ëŠ” ì¹¸ì´ë©´ _cells.Add(cellPos, cell) ë“±ë¡  
âœ” `Add(go)` - goì˜ ìœ„ì¹˜ë¥¼ grid ìœ„ì¹˜ë¡œ ë³€í™˜ í›„ cellì— ì¶”ê°€  
âœ” `Remove(go)` - goì˜ ìœ„ì¹˜ë¥¼ grid ìœ„ì¹˜ë¡œ ë³€í™˜ í›„ cellì—ì„œ ì œê±°  
âœ” `public List<GameObject> GatherObjects(Vector3 pos, float range)`  
&nbsp;&nbsp;íƒìƒ‰í•˜ê³ ì í•˜ëŠ” ìœ„ì¹˜ì—ì„œ range ë²”ìœ„ê¹Œì§€ì˜ ì…€ë“¤ ì¤‘ ë¬¼ì²´ê°€ ìˆëŠ” ëª¨ë“  ì…€ íƒìƒ‰, ë¦¬ìŠ¤íŠ¸ ë°˜í™˜   
âœ” WorldToCell(position) : ì›”ë“œ ì¢Œí‘œ => ê·¸ë¦¬ë“œ ì¢Œí‘œë¡œ ë³€í™˜   
âœ” CellToWorld(cellPosition) : ê·¸ë¦¬ë“œ ì¢Œí‘œ => ì›”ë“œ ì¢Œí‘œë¡œ ë³€í™˜  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  

<details>
<summary>GridController</summary>
<div class="notice--primary" markdown="1"> 

```c# 
using System.Collections.Generic;
using UnityEngine;

class Cell 
{
    public HashSet<GameObject> Objects { get; } = new HashSet<GameObject>();
}

public class GridController : BaseController
{
    UnityEngine.Grid _grid;

    Dictionary<Vector3Int, Cell> _cells = new Dictionary<Vector3Int, Cell>();
    
    public override bool Init()
    {
        base.Init();

        _grid = gameObject.GetOrAddComponent<UnityEngine.Grid>();

        return true;
    }

    public void Add(GameObject go) 
    {
        Vector3Int cellPos = _grid.WorldToCell(go.transform.position);

        Cell cell = GetCell(cellPos);
        if (cell==null)
            return;
        
        cell.Objects.Add(go);
    }
    public void Remove(GameObject go)
    {
        Vector3Int cellPos = _grid.WorldToCell(go.transform.position);

        Cell cell = GetCell(cellPos);
        if (cell == null)
            return;
        
        cell.Objects.Remove(go);
    }

    Cell GetCell(Vector3Int cellPos) 
    {
        Cell cell = null;

        if (_cells.TryGetValue(cellPos,out cell) ==false)
        {
            //ì²˜ìŒë³´ëŠ” ì¹¸ì´ë‹¤? => add ë“±ë¡
            cell = new Cell();
            _cells.Add(cellPos, cell);
        }
        return cell;
    }

    public List<GameObject> GatherObjects(Vector3 pos, float range) 
    {
        List<GameObject> objects = new List<GameObject>();

        Vector3Int left = _grid.WorldToCell(pos + new Vector3(-range, 0));
        Vector3Int right = _grid.WorldToCell(pos + new Vector3(+range, 0));
        Vector3Int bottom = _grid.WorldToCell(pos + new Vector3(0, -range));
        Vector3Int top = _grid.WorldToCell(pos + new Vector3(0, +range));

        int minX = left.x;
        int maxX = right.x;
        int minY = bottom.y;
        int maxY = top.y;

        for (int x = minX; x <= maxX; x++)
        {
            for (int y = minY; y <= maxY; y++)
            {
                if (_cells.ContainsKey(new Vector3Int(x, y, 0)) == false)
                    continue;

                objects.AddRange(_cells[new Vector3Int(x, y, 0)].Objects);
            }
        }
        return objects;
    }
}

```
- ì˜¤ë¸Œì íŠ¸ ë§¤ë‹ˆì €ì—ì„œ spawn, despawn ë  ë•Œ ê·¸ë¦¬ë“œ add, remove  
</div>
</details>

<br><br><br><br>

# ì´ê²ƒì €ê²ƒ ë©”ëª¨


<br><br><br>
- - - 

# ì¡ë‹´, ì¼ê¸°?
âœ” Grid ë” ì•Œì•„ë³´ê¸°  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--success}  


<br><br>
- - -