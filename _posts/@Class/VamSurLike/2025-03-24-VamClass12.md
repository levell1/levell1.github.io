---
title:  "[Unity ê°•ì˜] ë±€ì„œë¼ì´í¬ ê°•ì˜ - ìŠ¤í‚¬(íˆ¬ì‚¬ì²´) "
excerpt: ""

categories:
    - Class VamSurLike
tags:
    - [C#, Unity, VamSurLike]

toc: true
toc_sticky: true
 
date: 2025-03-23 05:00

---
- - -

<br>
- - - 

<!--&nbsp;ğŸ”¹ âœ” âœ…  -->


# ìŠ¤í‚¬ ì½”ë“œ 

## SkillController
âœ” ëª¨ë“  ìŠ¤í‚¬ì€ ì‚­ì œë˜ì–´ì•¼ ëœë‹¤. -> SkillControllerë¡œ   
âœ” ìŠ¤í‚¬ì˜ ì‚­ì œ -> ì½”ë£¨í‹´ìœ¼ë¡œ Poolë¡œ ë‹¤ì‹œ ë°˜í™˜  
âœ” ëª¨ë“  ìŠ¤í‚¬ ìƒì„± í›„ delaySecondsë¡œ ì¼ì • ì‹œê°„ í›„ Despawn()  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  

<details>
<summary>SkillController</summary>
<div class="notice--primary" markdown="1"> 

```c# 
using System.Collections;
using UnityEngine;

// EgoSword : í‰íƒ€
// FireProjectile : íˆ¬ì‚¬ì²´
// PoisonField : ë°”ë‹¥
public class SkillController : BaseController
{
    public SkillType SkillType {get; set;}
    public Data.SkillData SkillData { get; protected set; }

    #region Destroy
    Coroutine _coDestroy;

    public void StartDestroy(float delaySeconds) 
    {
        StopDestroy();
        _coDestroy = StartCoroutine(CoDestroy(delaySeconds));
    }

    public void StopDestroy() 
    {
        if (_coDestroy!=null)
        {
            StopCoroutine(_coDestroy);
            _coDestroy = null;
        }
    }

    IEnumerator CoDestroy(float delaySecond) 
    {
        yield return new WaitForSeconds(delaySecond);
        if (this.IsValid())
        {
            Managers.Object.Despawn(this);
        }
    }
    #endregion
}
```
</div>
</details>

<br><bR>

## ProjectileController
**íˆ¬ì‚¬ì²´ ìŠ¤í‚¬ êµ¬ì„±**   
ğŸ”¹ íˆ¬ì‚¬ì²´ë¥¼ ë°œì‚¬í•œ ê°ì²´ : _owner  
ğŸ”¹ íˆ¬ì‚¬ì²´ì˜ ë°©í–¥ : _moveDir  
ğŸ”¹ íˆ¬ì‚¬ì²´ ì†ë„ : _speed  
ğŸ”¹ íˆ¬ì‚¬ì²´ ì§€ì†ì‹œê°„ : _lifeTime  
âœ… ì´ˆê¸°í™”í•˜ëŠ” ì½”ë“œ Init()  
âœ… SET ì½”ë“œ (ì •ë³´ë¥¼ ì„¸íŒ…í•˜ëŠ”) (ğŸ”¹ìœ„ 4ê°œë¥¼ ì„¸íŒ…)  
âœ… OnTriggerEnter2D ëª¬ìŠ¤í„° Trigger ì‹œ ëŒ€ë¯¸ì§€, Despawn  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  

<details>
<summary>ProjectileController</summary>
<div class="notice--primary" markdown="1"> 

```c# 
using UnityEngine;

public class ProjectileController : SkillController
{
    CreatureController _owner;
    Vector3 _moveDir;
    float _speed = 10.0f;
    float _lifeTime = 10.0f;

    //âœ… ì´ˆê¸°í™”í•˜ëŠ” ì½”ë“œ Init()
    public override bool Init()
    {
        base.Init();

        StartDestroy(_lifeTime);

        return true;
    }

    //âœ… SET ì½”ë“œ (ì •ë³´ë¥¼ ì„¸íŒ…í•˜ëŠ”)
    public void SetInfo(int templateID, CreatureController owner, Vector3 moveDir) 
    {
        if (Managers.Data.SkillDic.TryGetValue(templateID, out Data.SkillData data) == false) 
        {
            Debug.Log($" ID : {templateID} ProjecteController SetInfo Failed ");
            return;
        }

        _owner = owner;
        _moveDir = moveDir;
        SkillData = data;
        //TODO : DATA Parsing

    }

    public override void UpdateController()
    {
        base.UpdateController();

        transform.position += _moveDir * _speed * Time.deltaTime;
    }


    //âœ… OnTriggerEnter2D ëª¬ìŠ¤í„° Trigger ì‹œ ëŒ€ë¯¸ì§€, Despawn  
    void OnTriggerEnter2D(Collider2D collision)
    {
        MonsterController mc = collision.gameObject.GetComponent<MonsterController>();
        if (mc.IsValid() == false)
            return;
        if (this.IsValid() == false)
            return;

        mc.OnDamaged(_owner, SkillData.damage);

        StopDestroy();
        Managers.Object.Despawn(this);
    }
}
```
</div>
</details>

<br><bR>

## ObjectManager
âœ” íˆ¬ì‚¬ì²´ì˜ ìŠ¤í°, ë””ìŠ¤í° ê´€ë¦¬  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  

<details>
<summary>ObjectManager</summary>
<div class="notice--primary" markdown="1"> 

```c# 
public class ObjectManager 
{
    public HashSet<ProjectileController> Projectiles { get; } = new HashSet<ProjectileController>();

    public T Spawn<T>(Vector3 position, int  templateID =0) where T : BaseController 
    {
        System.Type type = typeof(T);

        else if (type == typeof(ProjectileController))
        {
            GameObject go = Managers.Resource.Instantiate(SkillPrefabsName.FireProjectile, pooling: true);
            go.transform.position = position;

            ProjectileController pc = go.GetOrAddComponent<ProjectileController>();
            Projectiles.Add(pc);
            pc.Init();

            return pc as T;
        }
        return null;
    }

    public void Despawn<T>(T obj) where T : BaseController 
    {
        if (obj.IsValid()==false)
        {
            // ë””ë²„ê¹…ì½”ë“œ
            Debug.Log($"Object Pool Error Debuging");
        }
        System.Type type = typeof(T);

        else if (type == typeof(ProjectileController))
        {
            Projectiles.Remove(obj as ProjectileController);
            Managers.Resource.Destroy(obj.gameObject);
        }
}
```
</div>
</details>

<br><bR>

## PlayerController
âœ” _indicator, _fireSocketë¡œ ë°œì‚¬ì²´ì˜ ì‹œì‘ ì§€ì , Player ì •ì§€ ì‹œ ë°œì‚¬ì²´ ì •ì§€ ë¬¸ì œ í•´ê²°.   
âœ” í”Œë ˆì´ì–´ ìƒì„± ì‹œ - StartProjectile() : ì¼ì • ì‹œê°„ íˆ¬ì‚¬ì²´ ìƒì„±, íˆ¬ì‚¬ì²´ì˜ ì •ë³´ SET   
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--info}  

<details>
<summary>PlayerController</summary>
<div class="notice--primary" markdown="1"> 

```c# 
public class PlayerController : CreatureController
{
    Vector2 _moverDir = Vector2.zero;

    float EnvCollectDist { get; set; } = 1.0f;

    [SerializeField]
    Transform _indicator;
    [SerializeField]
    Transform _fireSocket;

    public Vector2 MoveDir 
    {
        get { return _moverDir; }
        set { _moverDir = value.normalized; }
    }


    public override bool Init()
    {
        if (base.Init() == false)
            return false;
        _speed = 5.0f;

        Managers.Game.OnMoveDirChanged += HandleOnMoveDirChanged;

        StartProjectile();

        return true;
    }

    //Temp
    #region FireProjectile

    Coroutine _coFireProjectile;

    void StartProjectile() 
    {
        if (_coFireProjectile != null)
            StopCoroutine(_coFireProjectile);
        _coFireProjectile = StartCoroutine(CoFireProjectile());
    }

    IEnumerator CoFireProjectile() 
    {
        WaitForSeconds wait = new WaitForSeconds(2f);
        while (true)
        {
            ProjectileController pc = Managers.Object.Spawn<ProjectileController>(_fireSocket.position,1);
            pc.SetInfo(1, this, (_fireSocket.position-_indicator.position).normalized);
            yield return wait;
        }
    }
    #endregion
}
```
</div>
</details>

<br><br><br><br>

# ì´ê²ƒì €ê²ƒ ë©”ëª¨

## ìŠ¤í‚¬ ë°ì´í„°,í”„ë¦¬íŒ¹, ê³„ì¸µêµ¬ì¡° í™•ì¸
ìŠ¤í‚¬ í”„ë¦¬íŒ¹, ë°ì´í„° ì–´ë“œë ˆì„œë¸”ì— ì¶”ê°€  
í”„ë¦¬íŒ¹ì„ ì‚¬ìš©í•´ ìŠ¤í‚¬ì´ ë°œë™ëœë‹¤.  
ìŠ¤í‚¬ ê³„ì¸µêµ¬ì¡° ë§Œë“¤ê¸°(SkillController -> ProjectileController)  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice} 

## ì•„ì´í…œ, ì¸ë²¤í† ë¦¬, ìŠ¤í‚¬ì˜ monobehaviourìƒì†?
ì•„ì´í…œ, ì¸ë²¤í† ë¦¬ëŠ” monobehaviourì´ í•„ìš” ì—†ì´ ë©”ëª¨ë¦¬ì—ë§Œ ë“¤ê³  ìˆìœ¼ë©´ ëœë‹¤.  
ìŠ¤í‚¬ì€ í™”ë©´ì— í‘œì‹œí•˜ê¸° ë•Œë¬¸ì— monobehaviour í•„ìš”  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice}


## ì˜¤ë¸Œì íŠ¸ í’€ ì˜¤ë¥˜ ì²´í¬
í’€ë§ ì˜¤ë¥˜ ì²´í¬ Extension - IsValidë¡œ ì²´í¬í•˜ê¸°  
âœ” ì´ë¯¸ ì£½ì€ targetì´ destroy ê°€ ì•„ë‹Œ ë¹„í™œì„±í™”ì´ê¸° ë•Œë¬¸ì—  
âœ” ì•„ì§ targetìœ¼ë¡œ ì„¤ì •ë¼ ì½”ë“œê°€ ì‹¤í–‰ë˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice}

<details>
<summary>Extension</summary>
<div class="notice--primary" markdown="1"> 

```c# 
using UnityEngine;

public static class Extension
{
	public static bool IsValid(this GameObject go)
	{
		return go != null && go.activeSelf;
	}

	public static bool IsValid(this BaseController bc)
	{
		return bc != null && bc.isActiveAndEnabled;
	}
}

```
</div>
</details>


<br><br><br>
- - - 

# ì¡ë‹´, ì¼ê¸°?
ìŠ¤í‚¬ ë§Œë“¤ë•Œ ê³ ë¯¼  
ë°ì´í„° ì„¤ê³„ ì •í•˜ê³ ,  
ìŠ¤í‚¬ë“¤(ë²„í”„, íŒ¨ì‹œë¸Œ, ë°œë™)ì„ ìŠ¤í‚¬ ë§¤ë‹ˆì €ë¡œ ë”°ë¡œ ê´€ë¦¬í• ì§€, PlayerControllerì—ì„œ í• ì§€  
=>? ëª¬ìŠ¤í„°ê°€ ìŠ¤í‚¬ì„ ì“°ë©´?  
ë²„í”„ ì¤‘ì²©ì€ ì–´ë–»ê²Œ í• ê¹Œ? ìƒìœ„ ë²„í”„ë§Œ í•˜ë‚˜ ì ìš©í•  ê²½ìš°ë„ ìˆê³ , ì¤‘ì²©í•´ì•¼ ë  ê²½ìš°ë„ ìˆë‹¤.  
íˆ¬ì‚¬ì²´ ë°”ë¼ë³´ëŠ” ë°©í–¥ ë§ê³  ì œì¼ ê°€ê¹Œìš´ ì ìœ¼ë¡œ ìˆ˜ì •í•´ ë³´ê¸°.  
{:style="border:1px solid #EAEAEA; border-radius: 7px;"}
{: .notice--success}  


<br><br>
- - -